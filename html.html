<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A-Frame VR â†’ AR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ar.js@2.2.2/aframe/build/aframe-ar.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      overflow: hidden;
    }
    
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    
    .info-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      color: white;
      padding: 20px;
      border-radius: 15px;
      max-width: 320px;
      pointer-events: auto;
    }
    
    .info-panel h2 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #00d4ff;
    }
    
    .info-panel p {
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 8px;
      color: #e0e0e0;
    }
    
    .controls {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      pointer-events: auto;
    }
    
    .btn {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: none;
      padding: 15px 25px;
      border-radius: 30px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:active {
      transform: scale(0.95);
    }
    
    .btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .scene-selector {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(10px);
      padding: 15px;
      border-radius: 12px;
      pointer-events: auto;
    }
    
    .scene-option {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
      border: 2px solid transparent;
    }
    
    .scene-option:hover {
      background: rgba(255, 255, 255, 0.25);
    }
    
    .scene-option.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: white;
    }
    
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 30px 40px;
      border-radius: 15px;
      font-size: 18px;
      z-index: 2000;
      display: none;
    }
    
    .loading.show {
      display: block;
    }
  </style>
</head>
<body>
  <!-- A-Frameã‚·ãƒ¼ãƒ³ -->
  <a-scene 
    id="scene"
    embedded 
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
    vr-mode-ui="enabled: false"
  >
    <!-- ç’°å¢ƒå…‰ -->
    <a-entity light="type: ambient; color: #FFF; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.5" position="1 1 0"></a-entity>
    
    <!-- VRç’°å¢ƒ1: å»ƒå€‰åº« -->
    <a-entity id="environment1" visible="true">
        <!-- 3Dãƒ¢ãƒ‡ãƒ«ï¼ˆå»ƒå€‰åº«ï¼‰ -->
        <a-entity 
          gltf-model="url(./models/abandoned_warehouse_-_interior_scene.glb)" 
          position="0 0 0" 
          scale="1 1 1"
          animation-mixer
        ></a-entity>
        
        <!-- è£œåŠ©ç…§æ˜ -->
        <a-entity light="type: point; color: #FFA500; intensity: 0.5" position="2 3 -2"></a-entity>
        <a-entity light="type: point; color: #87CEEB; intensity: 0.3" position="-2 2 2"></a-entity>
      </a-entity>
  
    
    <!-- VRç’°å¢ƒ2: æœªæ¥çš„ãªç©ºé–“ -->
    <a-entity id="environment2" visible="false">
      <!-- åºŠï¼ˆã‚°ãƒªãƒƒãƒ‰ï¼‰ -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="5" height="5" color="#1a1a2e" 
               material="shader: flat; wireframe: true; wireframeLinewidth: 2"></a-plane>
      
      <!-- æµ®éŠã™ã‚‹ç«‹æ–¹ä½“ -->
      <a-box position="-1.5 1 -2" width="0.5" height="0.5" depth="0.5" 
             color="#0f3460" animation="property: rotation; to: 0 360 360; loop: true; dur: 5000"></a-box>
      <a-box position="0 1.5 -2.5" width="0.4" height="0.4" depth="0.4" 
             color="#16213e" animation="property: rotation; to: 360 0 360; loop: true; dur: 4000"></a-box>
      <a-box position="1.5 0.8 -2" width="0.6" height="0.6" depth="0.6" 
             color="#533483" animation="property: rotation; to: 360 360 0; loop: true; dur: 6000"></a-box>
      
      <!-- ãƒã‚ªãƒ³ãƒªãƒ³ã‚° -->
      <a-torus position="0 1 -3" radius="1" radius-tubular="0.05" color="#00d4ff"
               animation="property: rotation; to: 0 360 0; loop: true; dur: 8000"></a-torus>
      
      <!-- å…‰ã‚‹çƒä½“ -->
      <a-sphere position="0 2 -3" radius="0.3" color="#ff00ff" 
                animation="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 2000"></a-sphere>
    </a-entity>
    
    <!-- VRç’°å¢ƒ3: è‡ªç„¶ã®æ£® -->
    <a-entity id="environment3" visible="false">
      <!-- è‰åœ° -->
      <a-plane position="0 0 0" rotation="-90 0 0" width="6" height="6" color="#7CFC00"></a-plane>
      
      <!-- æœ¨ã€…ï¼ˆç°¡ç•¥åŒ–ï¼‰ -->
      <a-cylinder position="-1.5 0.5 -2" radius="0.15" height="1.5" color="#8B4513"></a-cylinder>
      <a-cone position="-1.5 1.8 -2" radius-bottom="0.5" radius-top="0" height="1" color="#228B22"></a-cone>
      
      <a-cylinder position="1.5 0.6 -2.5" radius="0.18" height="1.8" color="#8B4513"></a-cylinder>
      <a-cone position="1.5 2.1 -2.5" radius-bottom="0.6" radius-top="0" height="1.2" color="#228B22"></a-cone>
      
      <a-cylinder position="0 0.4 -3" radius="0.12" height="1.2" color="#8B4513"></a-cylinder>
      <a-cone position="0 1.4 -3" radius-bottom="0.4" radius-top="0" height="0.8" color="#228B22"></a-cone>
      
      <!-- èŠ± -->
      <a-sphere position="-0.5 0.1 -1" radius="0.08" color="#FF1493"></a-sphere>
      <a-sphere position="0.5 0.1 -1.2" radius="0.08" color="#FFD700"></a-sphere>
      <a-sphere position="-1 0.1 -1.5" radius="0.08" color="#FF69B4"></a-sphere>
    </a-entity>
    
    <!-- ã‚«ãƒ¡ãƒ© -->
    <a-entity camera look-controls wasd-controls position="0 1.6 3"></a-entity>
  </a-scene>

  <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤UI -->
  <div class="overlay">
    <div class="info-panel">
      <h2>ğŸŒ A-Frame VR â†’ AR</h2>
      <p><strong>ç¾åœ¨:</strong> <span id="currentScene">ã‚·ãƒ³ãƒ—ãƒ«ãªéƒ¨å±‹</span></p>
      <p style="font-size: 12px; color: #999; margin-top: 10px;">
        å³ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ç’°å¢ƒã‚’åˆ‡ã‚Šæ›¿ãˆ<br>
        ã€ŒARé…ç½®ã€ã§åºŠã«é…ç½®ã§ãã¾ã™
      </p>
    </div>
    
    <div class="scene-selector">
      <div class="scene-option active" onclick="changeEnvironment(1)">
        ğŸ  ã‚·ãƒ³ãƒ—ãƒ«ãªéƒ¨å±‹
      </div>
      <div class="scene-option" onclick="changeEnvironment(2)">
        ğŸŒŒ æœªæ¥çš„ç©ºé–“
      </div>
      <div class="scene-option" onclick="changeEnvironment(3)">
        ğŸŒ² è‡ªç„¶ã®æ£®
      </div>
    </div>
    
    <div class="controls">
      <button class="btn" onclick="resetView()">
        <span>ğŸ”„</span>
        <span>ãƒªã‚»ãƒƒãƒˆ</span>
      </button>
      <button class="btn primary" onclick="takeScreenshot()">
        <span>ğŸ“¸</span>
        <span>ã‚¹ã‚¯ã‚·ãƒ§</span>
      </button>
    </div>
  </div>
  
  <div class="loading" id="loading">
    èª­ã¿è¾¼ã¿ä¸­...
  </div>

  <script>
    let currentEnv = 1;
  
  // â† â˜… ã“ã“ã«è¿½åŠ ã•ã‚Œã¾ã—ãŸ â˜…
  // iOSæ¤œå‡ºã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  
  if (isIOS) {
    console.log('ğŸ iOSç«¯æœ«ã‚’æ¤œå‡º - æœ€é©åŒ–ãƒ¢ãƒ¼ãƒ‰ã‚’é©ç”¨');
    
    // iOSç”¨ã®è»½é‡åŒ–è¨­å®š
    document.addEventListener('DOMContentLoaded', () => {
      const scene = document.querySelector('a-scene');
      // å½±ã‚’ç„¡åŠ¹åŒ–ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰
      scene.setAttribute('shadow', 'type: basic');
      
      // ã‚¢ãƒ³ãƒã‚¨ã‚¤ãƒªã‚¢ã‚·ãƒ³ã‚°ã‚’è»½é‡åŒ–
      scene.setAttribute('renderer', 'antialias: false; logarithmicDepthBuffer: true');
    });
  }
  
    
    // ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆ
    function changeEnvironment(envNumber) {
      // ã™ã¹ã¦éè¡¨ç¤º
      document.getElementById('environment1').setAttribute('visible', 'false');
      document.getElementById('environment2').setAttribute('visible', 'false');
      document.getElementById('environment3').setAttribute('visible', 'false');
      
      // é¸æŠã—ãŸç’°å¢ƒã‚’è¡¨ç¤º
      document.getElementById('environment' + envNumber).setAttribute('visible', 'true');
      currentEnv = envNumber;
      
      // UIæ›´æ–°
      const sceneNames = ['', 'ã‚·ãƒ³ãƒ—ãƒ«ãªéƒ¨å±‹', 'æœªæ¥çš„ç©ºé–“', 'è‡ªç„¶ã®æ£®'];
      document.getElementById('currentScene').textContent = sceneNames[envNumber];
      
      // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡¨ç¤º
      document.querySelectorAll('.scene-option').forEach((option, index) => {
        if (index === envNumber - 1) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
      
      console.log('ç’°å¢ƒåˆ‡ã‚Šæ›¿ãˆ:', sceneNames[envNumber]);
    }
    
    // ãƒ“ãƒ¥ãƒ¼ãƒªã‚»ãƒƒãƒˆ
    function resetView() {
      const camera = document.querySelector('[camera]');
      camera.setAttribute('position', '0 1.6 3');
      camera.setAttribute('rotation', '0 0 0');
    }
    
    // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
    function takeScreenshot() {
      const scene = document.querySelector('a-scene');
      const canvas = scene.canvas;
      
      // Canvasã‹ã‚‰ç”»åƒã‚’ç”Ÿæˆ
      canvas.toBlob((blob) => {
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.download = `vr-ar-screenshot-${Date.now()}.png`;
        link.href = url;
        link.click();
        URL.revokeObjectURL(url);
      });
      
      console.log('ğŸ“¸ ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ’®å½±');
    }
    
    // A-Frameã‚·ãƒ¼ãƒ³èª­ã¿è¾¼ã¿å®Œäº†
    document.querySelector('a-scene').addEventListener('loaded', () => {
      console.log('âœ… A-Frameã‚·ãƒ¼ãƒ³èª­ã¿è¾¼ã¿å®Œäº†');
      document.getElementById('loading').classList.remove('show');
    });
  </script>
</body>
</html>